---
layout: page
title: Аутентификация и авторизация
---
<section>
	<div>
		<h3>OAuth 2.0</h3>
		<hr />
		<p><a href="https://datatracker.ietf.org/doc/html/rfc6749">OAuth 2.0</a>, что означает «Открытая авторизация»,
			представляет собой фреймворк, предназначенный для предоставления согласованного доступа к ресурсам от
			имени пользователя без передачи учетных данных пользователя. <a href="https://datatracker.ietf.org/doc/html/rfc6749">
			OAuth 2.0</a> — это протокол авторизации, а не протокол аутентификации, он разработан в
			первую очередь как средство предоставления доступа к набору ресурсов, например, к удаленным API или
			данным пользователя.</p>
		<p>OAuth 2.0 заменяет и упраздняет протокол OAuth 1.0, описанный в
			<a href="https://datatracker.ietf.org/doc/html/rfc5849">RFC-5849.</a></p>
		<h4>Концепции</h4>
		<p>Протокол OAuth 2.0 определяет следующие объекты:</p>
		<ul>
			<li><strong>Владелец ресурса</strong>: пользователь или система, которая владеет защищенными ресурсами
				и может предоставлять к ним доступ.</li>
			<li><strong>Клиент</strong>: Клиент — это система, выполняющая запросы защищенных ресурсов от имени
				Владельца ресурса и с его разрешения.</li>
			<li><strong>Сервер авторизации</strong>: этот сервер получает запросы от Клиента на токены доступа и
				выдает их после успешной аутентификации с согласия Владельца ресурса.</li>
			<li><strong>Сервер ресурсов</strong>: сервер, который защищает ресурсы пользователя и получает запросы
				на доступ от Клиента. Он принимает и проверяет токен доступа от клиента и возвращает
				соответствующие ресурсы.</li>
			<li><strong>Токен доступа</strong>: часть данных, представляющая авторизацию на доступ к ресурсам от
				имени конечного пользователя.</li>
		</ul>
		<h4>Как работает OAuth 2.0?</h4>
		<p><img src="../images/oauth2.svg" width="60%" height="34%"></p>
		<ol>
			<li><strong>Запрос авторизации.</strong> Клиент запрашивает авторизацию у владельца ресурса. Запрос на
				авторизацию можно сделать непосредственно владельцу ресурса (как показано), или желательно
				косвенно через сервер авторизации в качестве посредника.</li>
			<li><strong>Разрешение на авторизацию</strong> Клиент получает разрешение на авторизацию (еще его называют
				грантом), которым являются учетные данные, представляющие полномочия владельца ресурса.</li>
			<li>Клиент запрашивает токен доступа, аутентифицируясь с помощью сервера авторизации, предоставляя ему
				разрешение (грант) на авторизацию.</li>
			<li>Сервер авторизации аутентифицирует клиента и валидирует разрешение на авторизацию (грант). Если оно
				валидно, то выдает токен доступа (access token).</li>
			<li>Клиент запрашивает защищенный ресурс у сервера ресурсов и аутентифицируется, предоставляя токен
				доступа.</li>
			<li>Сервер ресурсов проверяет токен доступа, и, если он действителен, обслуживает запрос.
				Предпочтительный метод получения клиентом разрешения на авторизацию от владельца ресурса
				(описанного на шагах (1) и (2)) — использовать сервер авторизации в качестве посредника.</li>
		</ol>
		<p>Проще говоря, получаем резрешение на авторизацию (грант), обмениваем этот грант на токен доступа, с этим
			токеном доступа запрашиваем нужный нам ресурс</p>
		<p>Как отмечалось выше, чаще всего сервер авторизации выступает в качестве посредника при получении разрешения
			на авторизацию. Ниже представлена схема для этого случая.</p>
		<p><img src="../images/oauth2_v2.svg" width="42%" height="33%"></p>
		<h5>Недостатки</h5>
		<p>Вот наиболее распространенные недостатки OAuth 2.0:</p>
		<ul>
			<li>Отсутствуют встроенные функции безопасности.</li>
			<li>Нет стандартной реализации.</li>
			<li>Нет общего набора прицелов.</li>
		</ul>
		<h4>Дополнительные источники</h4>
		<ul>
			<li><a href="https://datatracker.ietf.org/doc/html/rfc6749">OAuth 2.0: RFC-6749</a></li>
			<li><a href="https://oauth.net/2/">https://oauth.net</a></li>
			<li><a href="https://habr.com/ru/companies/vk/articles/115163/">https://habr.com/ru/companies/vk/articles/115163/</a></li>
			<li><a href="https://datatracker.ietf.org/doc/html/rfc5849">OAuth 1.0: RFC-5849</a></li>
		</ul>
	</div>
	<div>
		<hr />
		<h3>OpenID</h3>
		<hr />
		<p>OAuth 2.0 предназначен только для <em>авторизации</em>, для предоставления доступа к данным и функциям
			из одного приложения в другое. OpenID Connect Connect (OIDC) — это тонкий слой, который находится
			поверх OAuth 2.0 и добавляет информацию о входе в систему и профиле пользователя, вошедшего в систему.</p>
		<p>Когда сервер авторизации поддерживает OIDC, его иногда называют поставщиком удостоверений (IdP),
			поскольку он предоставляет информацию о владельце ресурса обратно клиенту. OpenID Connect является
			относительно новым, что приводит к более низкому внедрению и внедрению в отрасли лучших практик по
			сравнению с OAuth.</p>
		<h5>Концепции</h5>
		<p>Протокол OpenID Connect (OIDC) определяет следующие сущности:</p>
		<ul>
			<li><strong>Надежная сторона</strong>: текущее приложение.</li>
			<li><strong>Поставщик OpenID</strong>: по сути, это промежуточная служба, предоставляющая одноразовый
				код доверяющей стороне.</li>
			<li><strong>Конечная точка токена</strong>: веб-сервер, который принимает одноразовый код (OTC) и
				предоставляет код доступа, действительный в течение часа. Основное различие между OIDC и OAuth 2.0
				заключается в том, что токен предоставляется с использованием JSON Web Token (JWT).</li>
			<li><strong>Конечная точка UserInfo</strong>: Проверяющая сторона связывается с этой конечной точкой,
				предоставляя безопасный токен и получая информацию о конечном пользователе.</li>
		</ul>
		<p>И OAuth 2.0, и OIDC просты в реализации и основаны на JSON, который поддерживается большинством
			веб-приложений и мобильных приложений. Однако спецификация OpenID Connect (OIDC) более строгая,
			чем спецификация базового OAuth.</p>
	</div>
	<div>
		<hr />
		<h3>Единый вход (SSO)</h3>
		<hr />
		<p>Единый вход (SSO) — это процесс проверки подлинности, при котором пользователю предоставляется доступ к
			нескольким приложениям или веб-сайтам с использованием только одного набора учетных данных для входа.
			Это избавляет пользователя от необходимости отдельно входить в разные приложения.</p>
		<p>Учетные данные пользователя и другая идентифицирующая информация хранятся и управляются централизованной
			системой, которая называется Identity Provider (IdP). Identity Provider — это надежная система,
			обеспечивающая доступ к другим веб-сайтам и приложениям.</p>
		<p>Системы аутентификации на основе единого входа (SSO) обычно используются в корпоративных средах, где
			сотрудникам требуется доступ к нескольким приложениям их организаций.</p>
		<div>
			<h4>Компоненты</h4>
			<p>Давайте обсудим некоторые ключевые компоненты единого входа (SSO).</p>
			<h5>Поставщик удостоверений (IdP)</h5>
			<p>Информация об удостоверении пользователя хранится и управляется централизованной системой, называемой
				поставщиком удостоверений (IdP). Поставщик удостоверений аутентифицирует пользователя и предоставляет
				доступ поставщику услуг.</p>
			<p>Поставщик удостоверений может напрямую аутентифицировать пользователя, проверив имя пользователя и
				пароль или проверив утверждение об удостоверении пользователя, представленное отдельным поставщиком
				удостоверений. Поставщик удостоверений занимается управлением идентификаторами пользователей, чтобы
				освободить поставщика услуг от этой ответственности.</p>
			<h5>Поставщик услуг</h5>
			<p>Поставщик услуг предоставляет услуги конечному пользователю. Они полагаются на поставщиков удостоверений
				для подтверждения личности пользователя, и обычно некоторые атрибуты пользователя управляются
				поставщиком удостоверений. Поставщики услуг также могут поддерживать локальную учетную запись для
				пользователя вместе с атрибутами, уникальными для их службы.</p>
			<h5>Брокер идентификации</h5>
			<p>Брокер удостоверений действует как посредник, который соединяет несколько поставщиков услуг с
				различными поставщиками удостоверений. Используя Identity Broker, мы можем выполнять единый вход
				в любое приложение без проблем с протоколом, которому оно следует.</p>
			<div>
				<h4>SAML</h4>
				<p>Язык разметки утверждений безопасности — это открытый стандарт, который позволяет клиентам
					обмениваться информацией о безопасности, касающейся удостоверений, аутентификации и разрешений,
					в разных системах. SAML реализован со стандартом Extensible Markup Language (XML) для обмена
					данными.</p>
				<p>SAML специально обеспечивает федерацию удостоверений, позволяя поставщикам удостоверений (IdP)
					беспрепятственно и безопасно передавать аутентифицированные удостоверения и их атрибуты
					поставщикам услуг.</p>
			</div>
			<div>
				<h4>Как работает система единого входа?</h4>
				<p>Теперь давайте обсудим, как работает единый вход:</p>
				<ol>
					<li>Пользователь запрашивает ресурс из желаемого приложения.</li>
					<li>Приложение перенаправляет пользователя к поставщику удостоверений (IdP) для аутентификации.</li>
					<li>Пользователь входит в систему со своими учетными данными (обычно это имя пользователя и пароль).</li>
					<li>Поставщик удостоверений (IdP) отправляет ответ единого входа обратно в клиентское приложение.</li>
					<li>Приложение предоставляет доступ пользователю.</li>
				</ol>
			</div>
			<div>
				<h4>SAML против OAuth 2.0 и OpenID Connect (OIDC)</h4>
				<p>Существует много различий между SAML, OAuth и OIDC. SAML использует XML для передачи сообщений, а
					OAuth и OIDC используют JSON. OAuth упрощает работу, а SAML ориентирован на корпоративную
					безопасность.</p>
				<p>OAuth и OIDC широко используют связь RESTful, поэтому мобильные и современные веб-приложения
					считают OAuth и OIDC более удобными для пользователя. SAML, с другой стороны, отбрасывает
					сеансовый файл cookie в браузере, который позволяет пользователю получить доступ к определенным
					веб-страницам. Это отлично подходит для краткосрочных рабочих нагрузок.</p>
				<p>OIDC удобен для разработчиков и проще в реализации, что расширяет варианты использования, для
					которых он может быть реализован. Его можно довольно быстро реализовать с нуля с помощью свободно
					доступных библиотек на всех распространенных языках программирования. SAML может быть сложным в
					установке и обслуживании, с чем хорошо справляются только компании масштаба предприятия.</p>
				<p>OpenID Connect — это, по сути, слой поверх инфраструктуры OAuth. Следовательно, он может предложить
					встроенный уровень разрешений, который просит пользователя согласиться с тем, к чему может получить
					доступ поставщик услуг. Хотя SAML также может разрешать поток согласия, он достигает этого за счет
					жесткого кодирования, выполняемого разработчиком, а не как часть его протокола.</p>
				<p><em>Оба этих протокола аутентификации хороши в том, что они делают. Как всегда, многое зависит от
					наших конкретных вариантов использования и целевой аудитории.</em></p>
			</div>
			<div>
				<h4>Преимущества</h4>
				<p>Ниже приведены преимущества использования единого входа:</p>
				<ul>
					<li>Простота использования, так как пользователям нужно запомнить только один набор учетных данных.</li>
					<li>Простота доступа без необходимости проходить длительный процесс авторизации.</li>
					<li>Принудительная безопасность и соответствие требованиям для защиты конфиденциальных данных.</li>
					<li>Упрощение управления за счет снижения затрат на ИТ-поддержку и времени на администрирование.</li>
				</ul>
			</div>
			<div>
				<h4>Недостатки</h4>
				<p>Вот некоторые недостатки единого входа:</p>
				<ul>
					<li>Уязвимость с одним паролем: если основной пароль системы единого входа будет скомпрометирован,
						все поддерживаемые приложения будут скомпрометированы.</li>
					<li>Процесс аутентификации с использованием единого входа медленнее, чем традиционная
						аутентификация, поскольку каждое приложение должно запрашивать поставщика SSO для проверки.</li>
				</ul>
			</div>
			<div>
				<h4>Примеры</h4>
				<p>Вот некоторые часто используемые поставщики удостоверений (IdP):</p>
				<ul>
					<li><a href="https://www.okta.com">Окта</a><br />
						— <a href="https://cloud.google.com/architecture/identity/single-sign-on">Google</a></li>
					<li><a href="https://auth0.com">Auth0</a></li>
					<li><a href="https://www.onelogin.com">OneLogin</a></li>
				</ul>
			</div>
		</div>
		<div>
			<hr />
			<h3>SSL, TLS, mTLS</h3>
			<hr />
			<p>Давайте кратко обсудим некоторые важные протоколы безопасности связи, такие как SSL, TLS и mTLS. Я бы
				сказал, что с точки зрения проектирования системы в целом эта тема не очень важна, но о ней все равно
				полезно знать.</p>
			<div>
				<h4>SSL</h4>
				<p>SSL расшифровывается как Secure Sockets Layer и относится к протоколу для шифрования и защиты
					коммуникаций, которые происходят в Интернете. Впервые он был разработан в 1995 году, но с тех пор
					устарел в пользу TLS (Transport Layer Security).</p>
				<h5>Почему он называется сертификатом SSL, если он устарел?</h5>
				<p>Большинство основных поставщиков сертификатов по-прежнему называют сертификаты SSL-сертификатами,
					поэтому соглашение об именах сохраняется.</p>
				<h5>Почему SSL был так важен?</h5>
				<p>Первоначально данные в Интернете передавались в виде открытого текста, который любой мог прочитать,
					если перехватил сообщение. SSL был создан, чтобы решить эту проблему и защитить конфиденциальность
					пользователей. Шифруя любые данные, которые передаются между пользователем и веб-сервером, SSL
					также останавливает определенные виды кибератак, не позволяя злоумышленникам подделывать
					передаваемые данные.</p>
			</div>
			<div>
				<h4>TLS</h4>
				<p>Безопасность транспортного уровня, или TLS, — это широко распространенный протокол безопасности,
					предназначенный для обеспечения конфиденциальности и защиты данных при обмене данными через
					Интернет. TLS произошел от предыдущего протокола шифрования под названием Secure Sockets Layer
					(SSL). Основной вариант использования TLS — шифрование связи между веб-приложениями и серверами.</p>
				<p>Протокол TLS состоит из трех основных компонентов:</p>
				<ul>
					<li><strong>Шифрование</strong>: скрывает данные, передаваемые от третьих лиц.</li>
					<li><strong>Аутентификация</strong>: гарантирует, что стороны, обменивающиеся информацией, являются
						теми, за кого себя выдают.</li>
					<li><strong>Целостность</strong>: проверяет, что данные не были подделаны или изменены.</li>
				</ul>
			</div>
			<div>
				<h4>mTLS</h4>
				<p>Mutual TLS или mTLS — это метод взаимной аутентификации. mTLS гарантирует, что стороны на каждом
					конце сетевого соединения являются теми, за кого они себя выдают, проверяя, что они оба имеют
					правильный закрытый ключ. Информация в соответствующих сертификатах TLS обеспечивает дополнительную
					проверку.</p>
				<h5>Зачем использовать mTLS?</h5>
				<p>mTLS помогает обеспечить безопасность и надежность трафика в обоих направлениях между клиентом и
					сервером. Это обеспечивает дополнительный уровень безопасности для пользователей, которые входят
					в сеть или приложения организации. Он также проверяет соединения с клиентскими устройствами,
					которые не следуют процессу входа в систему, например с устройствами Интернета вещей (IoT).</p>
				<p>В настоящее время mTLS обычно используется микросервисами или распределенными системами в
					<a href="https://en.wikipedia.org/wiki/Zero_trust_security_model">модели безопасности с нулевым
					доверием</a> для проверки друг друга.</p>
			</div>
		</div>
	</div>
</section>

